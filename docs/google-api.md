# Google API の設定

Google Drive や Google Spreadsheets 等のサービスをプログラムから操作するための手続き(API)を設定します。

## Google アカウントの取得

* 大会運営に使用する Google アカウントを用意して下さい。
  普段使いされている個人のアカウントでも動作に支障はありませんが、万が一ツールの誤動作で無関係のファイルが削除されたりしないよう、[アカウントの新規作成](https://accounts.google.com/signup/v2/webcreateaccount?continue=https%3A%2F%2Faccounts.google.com%2FManageAccount%3Fnc%3D1&dsh=S638017899%3A1618735978930867&gmb=exp&biz=false&flowName=GlifWebSignIn&flowEntry=SignUp) を行うことをお勧めします。

## Google Cloud Platform のプロジェクト作成

Google API を使用するために Google Cloud Platform (これ以降GCPと略します) のプロジェクトを作成します。
なお、300ドル分の無料トライアル云々というバナーが表示されるかもしれませんが、本ツールが利用する範囲はそもそも無償ですので、そちらを利用する必要はありません。

* [GCPのダッシュボード](https://console.cloud.google.com/) を開き、用意した Google アカウントでログインして下さい。
  * 既に別のアカウントで Google にログインしている場合は、右上のアイコンから「アカウントの追加」を行い、アカウントを切り替えて下さい。
* 初めてGCPを利用する場合は、「ようこそ」というダイアログが表示されます。
  * 国は「日本」を選びます。
  * 利用規約等を読んだ上で「同意します」にチェックします。
  * 「同意して続行」をクリックします。
  * ダッシュボードに戻ります。
* 画面左上の「Google Cloud Platform」というタイトルの横にある「プロジェクトの選択」を選びます。
  * ダイアログが表示されますので、「新しいプロジェクト」をクリックします。
  * プロジェクトの設定を入力します。
    * プロジェクト名は他の用途でGCPを使う場合があった時に識別できるものであれば何でも構いません。
      ここでは仮に、 `dkoshien` をプロジェクト名とします。
    * 「場所」は「組織なし」のままで構いません。
    * 入力出来たら「作成」をクリックして下さい。
  * 自動的にダッシュボードに戻ります。

## サービスアカウントの作成

Google Drive や Google Spreadsheet をプログラムから操作するためのアカウント(サービスアカウント)を発行します。

* 画面左側のメニューから「APIとサービス」→「認証情報」を選択します。
  プロジェクトの選択画面が表示された場合には、先ほど作成したプロジェクトを選択します。
  * 「＋認証情報を作成」→「サービスアカウント」を選択します。
    * 「サービスアカウント名」は、半角英数字であれば何でも構いません。
      ここでは仮に、Pythonから操作するという意味で `python` をサービスアカウント名とします。
    * 「サービスアカウントID」は、サービスアカウント名を入力すると自動的に生成されるので、そのままで構いません。
    * 「サービスアカウントの説明」は、複数のアカウントを区別するためのものなので、特に無くても構いませんが、ここでは仮に、 `オンラインディベート運営支援ツール用` と入力します。
    * 「作成」をクリックします。
    * 続く設定がありますが、省略可なので、ここではスキップし、「完了」をクリックします。
    * 認証情報の画面に戻りますので、「サービス アカウント」の欄に作成した「サービスアカウントID」が加わっていることを確認して下さい。
      この「サービスアカウントID」は後の手順で必要になりますので、手元にメモしておいて下さい。
  * 「サービス アカウント」欄内の、いま作成したサービスアカウントIDをクリックします。
    * 「キー」のタブを選択し、「鍵を追加」→「新しい鍵を作成」を選択します。
    * ダイアログが開くので、「キーのタイプ」は「JSON」にチェックし、「作成」をクリックします。
    * 「xxxxx.json」というファイルのダウンロードが始まりますので、ローカルPC上の安全な場所に保存して下さい。
      **このファイルは文字通り「鍵」になるもので、万が一流出すると、この Google アカウントが行える操作(例えば Drive 上のファイルの閲覧、編集、削除)を、鍵を入手した第三者に利用されるリスクがあります。ご注意下さい。**
      また、鍵ファイルを誤って紛失すると、プログラムからの操作が出来なくなります。
      紛失してしまった場合は、再度「認証情報」→「キー」のタブを選択し、元々あるキーを削除して、新たなものを作成して下さい。
    * 画面左上の「Google Cloud Platform」というタイトルをクリックしてダッシュボードに戻ります。

## API の有効化

Google Drive や Google Spreadsheet をプログラムから操作する手順(API)を有効化します。

* 画面左側のメニューから「APIとサービス」→「ライブラリ」を選択します。
  * 「Google Dive API」をクリックします。
    一覧の中から見つけられない場合は「API とサービスを検索」の欄に「Drive」などと入力すれば絞り込めます。
  * 「有効にする」をクリックします。
  * 画面左上の「Google Cloud Platform」というタイトルをクリックしてダッシュボードに戻ります。
* もう一度、画面左側のメニューから「APIとサービス」→「ライブラリ」を選択します。
  * 「Google Sheets API」をクリックします。
    一覧の中から見つけられない場合は「API とサービスを検索」の欄に「Sheets」などと入力すれば絞り込めます。
  * 「有効にする」をクリックします。

以上です。GCPのウィンドウは閉じて構いません。

[→次の手順に進む](zoom-api.md)
